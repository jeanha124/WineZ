<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Wine in the USA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <!-- <script src="https://maps.google.com/maps/api/js?sensor=true"></script> -->
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>
  <script src="http://d3js.org/d3-geo-projection.v2.min.js"></script>
  <style>
    header {
      text-align: center;
    }
    .states {
      fill: #fff;
      stroke: black;
      stroke-width: 2px;
    }
    .states :hover {
      fill: #722f37;
    }
    .state-borders {
      fill: none;
      stroke-width: 1px;
    }
    
    footer {
      font: 20px;
      text-align: center;
    }

    #wine_info {
      border: 1px solid black;
      position: relative;
      padding: 8px;
      top: 20px;
      width: 300px;
    }
  </style>
</head>
<body>
  <header><h1>Wine in the USA</h1></header>
  <div id="map"></div>
  <div id="wine_filters">
    <span>View Wines according to - - -</span>
    <div id="top-wine-selector">
      <span>Please select a top choice: </span>
    </div>
    <div id="bottom-wine-selector">
      <span>Please select a low choice: </span>
    </div>
    <div id="expense-wine-selector">
      <span>Please select an expense: </span>
    </div>
  </div>
  <div id="wine_info">
    Name: <span id="title" class="info"></span><br>
    Description: <span id="description" class="info"></span><br>
    Variety: <span id="variety" class="info"></span><br>
    Price: <span id="price" class="info"></span><br>
  </div>
  <script>      
    
    let longlat = [{
      name: 'Alabama',
      lat: 32.806671,
      long: -86.791130
    },{
      name: 'Alaska',
      lat: 61.370716,
      long: -152.404419
    },{
      name: 'Arizona',
      lat: 33.729759,
      long: -111.431221
    }, {
      name: 'Arkansas',
      lat: 34.969704,
      long: -92.373123
    },{
      name: 'California',
      lat: 36.116203,
      long: -119.681564
    },{
      name: 'Colorado',
      lat: 39.059811,
      long: -105.311104
    },{
      name: 'Connecticut',
      lat: 41.597782,
      long: -105.311104
    },{
      name: 'Delaware',
      lat: 39.318523,
      long: -75.507141
    },{
      name: 'District of Columbia',
      lat: 38.897438,
      long: -77.026817
    },{
      name: 'Florida',
      lat: 27.766279,
      long: -81.686783
    },{
      name: 'Georgia',
      lat: 33.040619,
      long: -83.643074
    }, {
      name: 'Hawaii',
      lat: 21.094318,
      long: -157.498337
    }, {
      name: 'Idaho',
      lat: 44.240459,
      long: -114.478828
    }, {
      name: 'Illinois',
      lat: 40.349457,
      long: -88.986137
    }, {
      name: 'Indiana',
      lat: 39.849426,
      long: -86.258278
    }, {
      name: 'Iowa',
      lat: 42.011539,
      long: -93.210526
    }, {
      name: 'Kansas',
      lat: 38.526600,
      long: -96.726486
    }, {
      name: 'Kentucky',
      lat: 37.668140,
      long: -84.670067
    }, {
      name: 'Louisiana',
      lat: 31.169546,
      long: -91.867805
    }, {
      name: 'Maine',
      lat: 44.693947,
      long: -69.381927
    }, {
      name: 'Maryland',
      lat: 39.063946,
      long: -76.802101
    }, {
      name: 'Massachusetts',
      lat: 42.230171,
      long: -71.530106
    }, {
      name: 'Michigan',
      lat: 43.326618,
      long: -84.536095
    }, {
      name: 'Minnesota',
      lat: 45.694454,
      long: -93.900192
    }, {
      name: 'Mississippi',
      lat: 32.741646,
      long: -89.678696
    }, {
      name: 'Missouri',
      lat: 38.456085,
      long: -92.288368
    }, {
      name: 'Montana',
      lat: 46.921925,
      long: -110.454353
    }, {
      name: 'Nebraska',
      lat: 41.125370,
      long: -98.268082
    }, {
      name: 'Nevada',
      lat: 38.313515,
      long: -117.055374
    }, {
      name: 'New Hampshire',
      lat: 43.452492,
      long: -71.563896
    }, {
      name: 'New Jersey',
      lat: 40.298904,
      long: -74.521011
    }, {
      name: 'New Mexico',
      lat: 34.840515,
      long: -106.248482
    }, {
      name: 'New York',
      lat: 42.165726,
      long: -74.948051
    }, {
      name: 'North Carolina',
      lat: 35.630066,
      long: -79.806419
    }, {
      name: 'North Dakota',
      lat: 47.528912,
      long: -99.784012
    }, {
      name: 'Ohio',
      lat: 40.388783,
      long: -82.764915
    }, {
      name: 'Oklahoma',
      lat: 35.565342,
      long: -82.764915
    }, {
      name: 'Oregon',
      lat: 44.572021,
      long: -122.070938
    }, {
      name: 'Pennsylvania',
      lat: 40.590752,
      long: -77.209755
    }, {
      name: 'Rhode Island',
      lat: 41.680893,
      long: -71.511780
    }, {
      name: 'South Carolina',
      lat: 33.856892,
      long: -80.945007
    }, {
      name: 'South Dakota',
      lat: 44.299782,
      long: -99.438828
    }, {
      name: 'Tennessee',
      lat: 35.747845,
      long: -86.692345
    }, {
      name: 'Texas',
      lat: 31.054487,
      long: -97.563461
    }, {
      name: 'Utah',
      lat: 40.150032,
      long: -111.862434
    }, {
      name: 'Vermont',
      lat: 44.045876,
      long: -72.710686
    }, {
      name: 'Virgina',
      lat: 37.769337,
      long: -78.169968
    }, {
      name: 'Washington',
      lat: 47.400902,
      long: -121.490494
    }, {
      name: 'West Virgina',
      lat: 38.491226,
      long: -80.954453
    }, {
      name: 'Wisconsin',
      lat: 44.268543,
      long: -89.616508
    }, {
      name: 'Wyoming',
      lat: 42.755966,
      long: -107.302490
    }
    ];   
    
    let margin = {top: 50, left: 50, right: 50, bottom: 50},
    height = 500 - margin.top - margin.bottom,
    width = 900 - margin.left - margin.right;

    let svg = d3.select("#map")
        .append("svg")
        .attr("height", height + margin.top + margin.bottom)
        .attr("width", width + margin.left + margin.right)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    svg.append('rect')
      .attr('width', width + margin.left + margin.right)
      .attr('height', height + margin.top + margin.bottom)
      .attr('fill', 'lightblue');
    let states = svg.append('g')
                  .attr('class', 'states');
    let areas = svg.append('g')
                  .attr('class', 'areas');              
    let projection = d3.geoAlbersUsa()
        .translate([width/2, height/2])
        .scale(1000)

    let path = d3.geoPath().projection(projection) 
    
    //data groups
      let top_wine = ["all", "5", "10", "15", "20", "50", "100"],
        bottom_wine = ["all", "5", "10", "15", "20", "50", "100"],
        expense = ["all", "Expensive", "Budget"];

      let dropdown1 = d3.select('#top-wine-selector')
        .append('select')
        .selectAll('myOptions')
        .data(top_wine)
        .enter()
        .append('option')
        .text(function (d) { return d })
        .attr('value', function (d) { return d });
      let dropdown2 = d3.select('#bottom-wine-selector')
        .append('select')
        .selectAll('myOptions')
        .data(bottom_wine)
        .enter()
        .append('option')
        .text(function (d) { return d })
        .attr('value', function (d) { return d });
      let dropdown3 = d3.select('#expense-wine-selector')
        .append('select')
        .selectAll('myOptions')
        .data(expense)
        .enter()
        .append('option')
        .text(function (d) { return d })
        .attr('value', function (d) { return d });

      d3.csv("https://raw.githubusercontent.com/jeanha124/WineZ/master/wine-data2.csv", (d) => {
        return {
          title: d.title,
          description: d.description,
          variety: d.variety,
          winery: d.winery,
          province: d.province,
          points: d.points,
          price: d.price
        };
      }, function (data) {
        data.forEach(function (d) {
          let result = longlat.filter(function (lonlat) {
            return lonlat.name === d.province;
          });
          d.long = (result[0] !== undefined) ? result[0].long : null;
          d.lat = (result[0] !== undefined) ? result[0].lat : null;
        });
      
        console.log(data);

        
        

         let quantityById = {};
        data.forEach(function (d) {
          if (quantityById[d.province]) {
            quantityById[d.province] += 1;
          } else {
            quantityById[d.province] = 1;
          }
        })
        console.log(quantityById)

        let minimum = d3.entries(quantityById)
          // sort by value asscending
          .sort(function (a, b) { return d3.ascending(a.value, b.value); })
        // take the first option
        [0],
          maximum = d3.entries(quantityById)
            // sort by value descending
            .sort(function (a, b) { return d3.descending(a.value, b.value); })
          // take the first option
          [0];

        let minColor = '#f2f0f7',
          maxColor = '#54278f';

        console.log(minimum, maximum);

        let color = d3.scaleThreshold()
          .domain([minimum, maximum])
          .range([minColor, maxColor]);

        d3.json("https://raw.githubusercontent.com/jeanha124/WineZ/master/us-states.json", function (error, us) {
          if (error) throw error;
 
          states.selectAll("path")
          .data(topojson.feature(us, us.objects.states).features)
          .enter().append("path")
          .attr("d", path)
          .style('fill', function (d) {
            console.log(quantityById[d]);
            
            
          });
          

        });

          
        

    });

    

    

  </script>
  <footer style='width: 100%; background: red; position: absolute; bottom: 0;'>
      <a style='color: white;' href='https://jeanwooha.me'>Portfolio</a>
      <a style='color: white;' href='https://linkedin.com/in/jeanha124'>LinkedIn</a>
      <a style='color: white;' href='https://github.com/jeanha124'>Github</a>
  </footer>
</body>
</html>